{% extends 'base.html' %}

{% block title %}Ajouter un utilisateur{% endblock %}

{% block header %}Ajouter un nouvel utilisateur{% endblock %}
{% block sidebar %}
    <a href="{% url 'admin_dashboard' %}" class="flex items-center space-x-3 p-3 rounded-lg text-white bg-emerald-600 font-semibold shadow-md transition duration-150 ease-in-out">
        <i class="fa-solid fa-gauge-high w-5 h-5"></i>
        <span>Tableau de bord</span>
    </a>
    <a href="{% url 'list_doctors' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
        <i class="fa-solid fa-user-doctor w-5 h-5"></i>
        <span>Docteurs</span>
    </a>
    <a href="{% url 'list_patients' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
        <i class="fa-solid fa-user-injured w-5 h-5"></i>
        <span>Patients</span>
    </a>
    <a href="{% url 'admin_confirmed_appointments' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
        <i class="fa-solid fa-calendar-check w-5 h-5"></i>
        <span>Rendez-vous Confirmés</span>
    </a>
{% endblock %}
{% block content %}
<script>
  // Fonction pour afficher/cacher les champs docteur selon le type d'utilisateur
  function toggleFields() {
    const userType = document.getElementById("user_type").value;
    const doctorFields = document.getElementById("doctor_fields");

    if (userType === "doctor") {
      doctorFields.classList.remove("max-h-0", "opacity-0");
      doctorFields.classList.add("max-h-96", "opacity-100");
      // Rendre les champs requis
      doctorFields.querySelectorAll("input, textarea").forEach(el => el.required = true);
    } else {
      doctorFields.classList.remove("max-h-96", "opacity-100");
      doctorFields.classList.add("max-h-0", "opacity-0");
      // Retirer l'attribut required pour ne pas bloquer le formulaire patient
      doctorFields.querySelectorAll("input, textarea").forEach(el => el.required = false);
    }
  }

  document.addEventListener("DOMContentLoaded", toggleFields);
</script>

<div class="w-full max-w-3xl mx-auto bg-white rounded-3xl shadow-2xl p-8 lg:p-12 border border-gray-100">
  <h1 class="text-3xl font-extrabold text-gray-800 mb-8 flex items-center">
    <i class="fa-solid fa-user-plus text-emerald-500 mr-3"></i> Création de compte
  </h1>

  {% if messages %}
    {% for message in messages %}
      <div class="p-4 mb-4 text-sm rounded-lg 
        {% if message.tags == 'success' %}bg-green-100 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-100 text-red-800 border border-red-200{% else %}bg-blue-100 text-blue-800 border border-blue-200{% endif %}" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <form method="POST" class="space-y-6">
    {% csrf_token %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Type utilisateur -->
      <div>
        <label for="user_type" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-user-tag mr-2 text-blue-500"></i> Type d'utilisateur
        </label>
        <select id="user_type" name="user_type" onchange="toggleFields()" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm">
          <option value="patient">Patient</option>
          <option value="doctor">Docteur</option>
        </select>
      </div>

      <!-- Nom d'utilisateur -->
      <div>
        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-user mr-2 text-blue-500"></i> Nom d'utilisateur <span class="text-red-500">*</span>
        </label>
        <input type="text" id="username" name="username" required class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: jean.dupont">
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-envelope mr-2 text-blue-500"></i> Email <span class="text-red-500">*</span>
        </label>
        <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: jean.dupont@hms.com">
      </div>

      <!-- Mot de passe -->
      <div>
        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-lock mr-2 text-blue-500"></i> Mot de passe <span class="text-red-500">*</span>
        </label>
        <input type="password" id="password" name="password" required class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Minimum 8 caractères">
      </div>

      <!-- Nom complet -->
      <div>
        <label for="full_name" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-id-card mr-2 text-blue-500"></i> Nom complet <span class="text-red-500">*</span>
        </label>
        <input type="text" id="full_name" name="full_name" required class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: Jean Dupont">
      </div>

      <!-- Âge -->
      <div>
        <label for="age" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-cake-candles mr-2 text-blue-500"></i> Âge
        </label>
        <input type="number" id="age" name="age" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: 35">
      </div>
    </div>

    <!-- Champs spécifiques au docteur -->
    <div id="doctor_fields" class="overflow-hidden max-h-0 opacity-0 transition-all duration-500 border-t pt-6 mt-6 border-gray-200">
      <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fa-solid fa-user-doctor mr-2 text-red-500"></i> Informations Docteur
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="specialization" class="block text-sm font-medium text-gray-700 mb-1">
            <i class="fa-solid fa-stethoscope mr-2 text-red-500"></i> Spécialisation <span class="text-red-500">*</span>
          </label>
          <input type="text" id="specialization" name="specialization" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: Cardiologie">
        </div>

        <div>
          <label for="experience_years" class="block text-sm font-medium text-gray-700 mb-1">
            <i class="fa-solid fa-clock-rotate-left mr-2 text-red-500"></i> Années d'expérience <span class="text-red-500">*</span>
          </label>
          <input type="number" id="experience_years" name="experience_years" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: 10">
        </div>
      </div>

      <div class="mt-6">
        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-file-lines mr-2 text-red-500"></i> Description
        </label>
        <textarea id="description" name="description" rows="3" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-150 ease-in-out shadow-sm" placeholder="Courte biographie du docteur..."></textarea>
      </div>
    </div>

    <!-- Champs communs supplémentaires -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-6 mt-6 border-gray-200">
      <div>
        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-phone mr-2 text-blue-500"></i> Téléphone
        </label>
        <input type="text" id="phone" name="phone" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: +212 6 00 00 00 00">
      </div>

      <div>
        <label for="address" class="block text-sm font-medium text-gray-700 mb-1">
          <i class="fa-solid fa-location-dot mr-2 text-blue-500"></i> Adresse
        </label>
        <input type="text" id="address" name="address" class="w-full border border-gray-300 rounded-xl py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition duration-150 ease-in-out shadow-sm" placeholder="Ex: 123 Rue Principale, Ville">
      </div>
    </div>

    <button type="submit" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-xl py-3 px-4 transition duration-150 ease-in-out shadow-lg hover:shadow-xl mt-8 flex items-center justify-center space-x-2">
      <i class="fa-solid fa-circle-check"></i>
      <span>Créer le compte</span>
    </button>
  </form>
</div>
{% endblock %}