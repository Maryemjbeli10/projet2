{% extends 'base.html' %}
{% block title %}Mes Ordonnances{% endblock %}
{% block header %}Mes Ordonnances{% endblock %}

{% block sidebar %}
    <a href="{% url 'doctor_dashboard' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
        <i class="fa-solid fa-gauge-high w-5 h-5"></i>
        <span>Tableau de bord</span>
    </a>
    <a href="{% url 'doctor_finished_patients' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
        <i class="fa-solid fa-user-injured w-5 h-5"></i>
        <span>Mes Patients</span>
    </a>
    <a href="{% url 'doctor_weekly_schedule' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
        <i class="fa-solid fa-calendar-week w-5 h-5"></i>
        <span>Mon Planning</span>
    </a>
    <!--
    <a href="{% url 'create_ordonnance' %}"class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
        <i class="fa-solid fa-calendar-check w-5 h-5"></i>
        <span>Créer Ordonnance
        </span>
    </a>
    <a href="{% url 'doctor_ordonnances' %}" class="flex items-center space-x-3 p-3 rounded-lg font-medium transition duration-150 ease-in-out
          {% if request.resolver_match.url_name == 'doctor_ordonnances' %}
            text-white bg-emerald-600 shadow-md
          {% else %}
            text-gray-700 hover:bg-gray-100
          {% endif %}">
      <i class="fa-solid fa-prescription-bottle-medical w-5 h-5"></i>
      <span>Mes Ordonnances</span>
    </a>
    -->
    <a href="{% url 'profile_info' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 ease-in-out">
        <i class="fa-solid fa-user-gear w-5 h-5"></i>
        <span>Mon Profil</span>
    </a>
{% endblock %}

{% block content %} 
<!-- BARRE DE FILTRES -->
  <form method="get" class="flex flex-wrap items-end gap-4 mb-8">
    <div class="flex-1 min-w-[220px]">
      <label class="block text-sm font-medium text-gray-700 mb-1">Nom du patient</label>
      <input type="text" name="search" value="{{ request.GET.search }}"
             placeholder="Saisir un nom…"
             class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500">
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Priorité</label>
      <select name="status" class="border border-gray-300 rounded-lg px-4 py-2">
        <option value="">-- Toutes --</option>
        <option value="Normal"  {% if request.GET.status == 'Normal' %}selected{% endif %}>Normal</option>
        <option value="Urgent"  {% if request.GET.status == 'Urgent' %}selected{% endif %}>Urgent</option>
      </select>
    </div>

    <button class="bg-emerald-600 text-white rounded-lg px-5 py-2 hover:bg-emerald-700 transition">
      Filtrer
    </button>
    <a href="{% url 'doctor_ordonnances' %}"
       class="bg-gray-200 text-gray-700 rounded-lg px-5 py-2 hover:bg-gray-300 transition">
      Réinitialiser
    </a>
  </form>

  <!-- LISTE -->
  {% if ordonnances %}
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {% for ord in ordonnances %}
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition">
          <div class="flex justify-between items-start mb-4">
            <span class="text-sm font-semibold text-emerald-600 bg-emerald-100 px-3 py-1 rounded-full">
              #{{ ord.id }}
            </span>
            <span class="text-xs text-gray-500">{{ ord.date_created|date:"d/m/Y" }}</span>
          </div>

          <h3 class="text-lg font-bold text-gray-900 mb-1">{{ ord.patient.full_name }}</h3>
          <p class="text-sm text-gray-600 mb-4">{{ ord.patient.age }} ans • {{ ord.patient.phone }}</p>

          <div class="space-y-2 text-sm text-gray-700">
            <p><strong>Diagnostic :</strong> {{ ord.diagnostic|truncatewords:10|default:"-" }}</p>
            <p><strong>Prescription :</strong> {{ ord.prescription|truncatewords:10|default:"-" }}</p>
            <p><strong>Notes :</strong> {{ ord.notes|truncatewords:8|default:"-" }}</p>
            <p><strong>Priorité :</strong>
              <span class="ml-2 px-2 py-1 text-xs rounded-full
                {% if ord.priority == 'Urgent' %}bg-red-100 text-red-700{% else %}bg-gray-100 text-gray-700{% endif %}">
                {{ ord.priority|default:"Normal" }}
              </span>
            </p>
          </div>

          <div class="mt-4 flex items-center justify-between">
            <a href="{% url 'ordonnance_pdf' ord.id %}"
               class="inline-flex items-center px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-lg hover:bg-emerald-700 transition">
              <i class="fa-solid fa-download mr-2"></i> Télécharger PDF
            </a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-12">
      <i class="fa-solid fa-prescription-bottle-medical text-6xl text-gray-300 mb-4"></i>
      <h2 class="text-xl font-semibold text-gray-700">Aucune ordonnance trouvée</h2>
      <p class="text-gray-500 mt-2">Ajustez vos filtres ou créez une nouvelle ordonnance.</p>
    </div>
  {% endif %}
</div>
{% endblock %}