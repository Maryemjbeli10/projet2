{% extends 'base.html' %}

{% block title %}Dossier de {{ patient.full_name }}{% endblock %}
{% block header %}Dossier médical de {{ patient.full_name }}{% endblock %}

{% block sidebar %}
<a href="{% url 'doctor_dashboard' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
    <i class="fa-solid fa-gauge-high w-5 h-5"></i>
    <span>Tableau de bord</span>
</a>
<a href="{% url 'doctor_finished_patients' %}" class="flex items-center space-x-3 p-3 rounded-lg text-white bg-emerald-600 font-semibold shadow-md">
    <i class="fa-solid fa-user-check w-5 h-5"></i>
    <span>Mes Patients</span>
</a>
<a href="{% url 'doctor_weekly_schedule' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
    <i class="fa-solid fa-calendar-week w-5 h-5"></i>
    <span>Mon Planning</span>
</a>
<!--
<a href="{% url 'create_ordonnance' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
    <i class="fa-solid fa-calendar-check w-5 h-5"></i>
    <span>Créer Ordonnance</span>
</a>
<a href="{% url 'doctor_ordonnances' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
    <i class="fa-solid fa-prescription-bottle-medical w-5 h-5"></i>
    <span>Mes Ordonnances</span>
</a>
-->
<a href="{% url 'profile_info' %}" class="flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition">
    <i class="fa-solid fa-user-gear w-5 h-5"></i>
    <span>Mon Profil</span>
</a>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-6 flex items-center">
        <i class="fa-solid fa-folder-open text-emerald-500 mr-3"></i>
        Dossier médical de {{ patient.full_name }}
    </h1>

    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Informations du patient</h2>
        <p><strong>Nom :</strong> {{ patient.full_name }}</p>
        <p><strong>Âge :</strong> {{ patient.age }} ans</p>
        <p><strong>Téléphone :</strong> {{ patient.phone }}</p>
        <p><strong>Adresse :</strong> {{ patient.address }}</p>
    </div>

    <h2 class="text-xl font-semibold text-gray-800 mb-4">Ordonnances</h2>

    {% if ordonnances %}
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {% for ord in ordonnances %}
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 hover:shadow-xl transition">
                    <div class="flex justify-between items-start mb-4">
                        <span class="text-sm font-semibold text-emerald-600 bg-emerald-100 px-3 py-1 rounded-full">
                            #{{ ord.id }}
                        </span>
                        <span class="text-xs text-gray-500">{{ ord.date_created|date:"d/m/Y" }}</span>
                    </div>

                    <p><strong>Diagnostic :</strong> {{ ord.diagnostic|truncatewords:10|default:"-" }}</p>
                    <p><strong>Prescription :</strong> {{ ord.prescription|truncatewords:10|default:"-" }}</p>
                    <p><strong>Notes :</strong> {{ ord.notes|truncatewords:8|default:"-" }}</p>
                    <p><strong>Priorité :</strong>
                        <span class="ml-2 px-2 py-1 text-xs rounded-full
                            {% if ord.priority == 'Urgent' %}bg-red-100 text-red-700
                            {% else %}bg-gray-100 text-gray-700{% endif %}">
                            {{ ord.priority|default:"Normal" }}
                        </span>
                    </p>

                    <div class="mt-4">
                        <a href="{% url 'ordonnance_pdf' ord.id %}"
                           class="inline-flex items-center px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-lg hover:bg-emerald-700 transition">
                            <i class="fa-solid fa-download mr-2"></i> Télécharger PDF
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-500">Aucune ordonnance trouvée pour ce patient.</p>
    {% endif %}

    <div class="mt-8">
        <a href="{% url 'doctor_finished_patients' %}"
           class="inline-flex items-center px-5 py-2.5 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> Retour à la liste des patients
        </a>
    </div>
</div>
{% endblock %}